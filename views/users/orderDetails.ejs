<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Details | The Style</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style1.css">
    <link rel="stylesheet" href="/css/orderDetails.css">
    <link href="/adminassets/css/main.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top py-3">
            <div class="container">
                <a href=""><img style="width: 100px; height: 40px;" src="/adminassets/imgs/theme/logo.png" alt=""></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="/">Home</a>
                        </li>
                        <li class="nav-item">
                            <% if (!user) { %>
                                <a class="nav-link" href="/login">Shop</a>
                                <% } else { %>
                                    <a class="nav-link" href="/products">Shop</a>
                            <% } %>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/brand">Brands</a>
                        </li>
                        <li class="nav-item">
                            <% if (!user) { %>
                                <a class="nav-link" href="/login">New Arrivals</a>
                                <% } else { %>
                                    <a class="nav-link" href="/newarrival">New Arrivals</a>
                            <% } %>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Contact</a>
                        </li>
                    </ul>
                    <div class="d-flex">
                        <% if (user) { %>
                            <a href="/userDash" class="nav-icon me-3"><i class="fas fa-user"></i></a>
                           <% } %>
                        <% if (!user) { %>
                            <a href="/login" class="nav-icon me-3 position-relative">
                                <i class="fas fa-shopping-bag"></i>
                                <span class="cart-count">2</span>
                            </a>
                            <% } else { %>
                                <a href="/cart" class="nav-icon me-3 position-relative">
                                    <i class="fas fa-shopping-bag"></i>
                                     <% if (cartCount) { %>
                                  <span class="cart-count"><%= cartCount%></span>
                                  <% } else { %>
                                    <span class="cart-count">0</span>
                                <% } %>
                                </a>
                        <% } %>
                        <% if (!user) { %>
                            <a href="/login" style="padding: 5px;font-size: 12px;font-weight: bold;" class="btn btn-dark btn-lg me-2 mb-2">Login</a>
                            <a href="/signup" style="padding: 5px;font-size: 12px;font-weight: bold;" class="btn btn-dark btn-lg me-2 mb-2">Signup</a>
                        <% } %>
                        <% if (user) { %>
                            <a href="/logout" style="padding: 5px;font-size: 12px;font-weight: bold;margin-left: 25px;" class="btn btn-dark btn-lg me-2 mb-2">Logout</a>
                           <% } %>
    
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Order Detail Section -->
    <section class="order-detail-section py-5 mt-5">
        <div class="container">
            <div class="dashboard-container" style="margin-top: 55px;">
                <!-- Sidebar -->
                <div class="col-lg-3 mb-4 mb-lg-0">
                    <div class="account-sidebar">
                        <div class="user-profile text-center mb-4">
                            <div class="user-avatar mb-3">
                                <img src="/adminassets/imgs/people/ddd.png" alt="User Avatar" class="rounded-circle" width="80" height="80">
                            </div>
                            
                            <h5 class="user-name mb-1"><%= user.name %></h5>
                            <p class="user-email text-muted mb-0"><%= user.email %></p>
                        </div>
                        <div class="list-group">
                            <a href="/userDash" class="list-group-item list-group-item-action ">
                                <i class="fas fa-tachometer-alt me-2"></i> My Profile
                            </a>
                            <a href="/myOrder" class="list-group-item list-group-item-action active">
                                <i class="fas fa-shopping-bag me-2"></i> My Orders
                            </a>
                            <a href="/wishlist" class="list-group-item list-group-item-action">
                                <i class="fas fa-heart me-2"></i> My Wishlist
                            </a>
                            <a href="/address" class="list-group-item list-group-item-action">
                                <i class="fas fa-map-marker-alt me-2"></i> My Addresses
                            </a>
                            <a href="/mywallet" class="list-group-item list-group-item-action">
                                <i class="fas fa-wallet me-2"></i> My Wallet
                            </a>
                            <a href="/logout" class="list-group-item list-group-item-action text-danger">
                                <i class="fas fa-sign-out-alt me-2"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="dashboard-content mt-5">
                    <div class="card border-0 shadow-sm ">
                        <div class="card-body p-4">
                            <!-- Order Header -->
                            <div class="order-header">
                                <div>
                                    <h4 class="mb-1">Order Details</h4>
                                    <div class="order-id">Order ID: <%= orders.orderId %></div>
                                </div>
                                <div>
                                    <div class="text-end">
                                    
                                        <div class="order-date">Placed on: <%= month %></div>
                                    </div>
                                    <% if (orders.paymentStatus=='Pending') { %>
                                     <div class="mt-2 ms-5">
                                        <a onclick="retryPayment('<%=orders._id%>')" class="btn btn-sm btn-outline-dark">
                                        <i class="fas fa-file-invoice me-1 mb-1"></i> Retry Payment
                                        </a>
                                    </div>
                                    <% } else { %>
                                     <div class="mt-2 ms-5">
                                        <a href="/order/invoice/<%= productElem._id %>" class="btn btn-sm btn-outline-dark">
                                        <i class="fas fa-file-invoice me-1 mb-1"></i> Invoice
                                        </a>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                            <input type="hidden" name="default-address" id="default-address" value="<%= address%>">
                            <input type="hidden"  id="total-price" value="<%=orders.totalAmount %>">
                            <input type="hidden" id="cart" value="<%= cart %>">
                            
                            <!-- Product Details -->
                        <% orders.products.forEach(prod => { %>
                              
                            
                            <div class="order-product">
                                <img src="https://res.cloudinary.com/<%= cloudName %>/image/upload/<%= prod.productId.images[0] %> " alt="Men Tartan Checks Checked Slim Fit Opaque Casual Shirt" class="product-image">
                                <div class="product-details">
                                    <h5 class="product-name"></h5>
                                    <div class="product-meta">Brand: Tommy Hilfiger</div>
                                    <div class="product-meta">Name: <%= prod.productId.name %></div>
                                    <div class="product-meta">Size: <%= prod.size %></div>
                                    <div class="product-meta">Quantity: <%= prod.quantity %></div>
                                <div class="product-meta">Status: <span class="status-badge" ><%= prod.status %> </span></div>
                                    <div class="product-price">₹ <%= orders.totalAmount %></div>
                                </div>
                                <div class="text-end d-flex flex-column justify-content-end" >
                                    
                                    <div class="d-flex flex-row gap-2">
                                        <div class="mt-5">
                                            <% if (prod.status == 'Delivered' ) { %>
                                                <button class="btn btn-warning" onclick="returnOrderOpenModal('<%= prod._id%>','<%=orders._id%>','<%=prod.status%>')" data-bs-toggle="modal" data-bs-target="#returnReasonModal">Return</button>
                                            <% } %>
                                            
                                        </div>
                                        <div class="mt-5">
                                            <% if (prod.status !== "Delivered" && prod.status !== "Return" && prod.status !=="Cancelled" && prod.status !== 'Return Processing' && prod.status !== 'Pending' && prod.status !== 'Returned' ){ %>
                                                <button onclick="openModal('<%=prod._id%>','<%=orders._id%>')"  class="btn btn-danger cancel">Cancel</button>
                                                
                                            <% } %>
                                            
                                           
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                            <% }) %>
                            
                            <!-- Delivery Information -->
                            <div class="delivery-info">
                                <h5 class="mb-3">Delivery Information</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="delivery-address">
                                            <h6>Shipping Address</h6>
                                            <p class="mb-1"><%= orders.address.firstName%></p>
                                            <p class="mb-1"><%= orders.address.addressLine %>, <%= orders.address.city %></p>
                                            <p class="mb-1"><%= orders.address.city %>, <%= orders.address.state %> - <%= orders.address.zipCode %></p>
                                            <p class="mb-0">Mobile: <%= orders.address.phoneNumber %></p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Estimated Delivery</h6>
                                        <p class="mb-0"><%= month %></p>
                                        <div class="col-md-6 mt-2">
                                            <h6>Payment Method</h6>
                                            <p class="mb-0"><%= orders.paymentMethod %></p>
                                        </div>
                                    </div>
                                    
                                    
                                </div>
                                
                            </div>
                            
                            <!-- Delivery Timeline -->
                            <!-- <div class="delivery-timeline">
                                <div class="timeline-item active">
                                    <div class="timeline-date">22 Apr 2025, 10:30 AM</div>
                                    <div class="timeline-title">Order Placed</div>
                                    <div class="timeline-text">Your order has been placed successfully.</div>
                                </div>
                                <div class="timeline-item active">
                                    <div class="timeline-date">22 Apr 2025, 2:45 PM</div>
                                    <div class="timeline-title">Order Confirmed</div>
                                    <div class="timeline-text">Your order has been confirmed and is being processed.</div>
                                </div>
                                <div class="timeline-item pending">
                                    <div class="timeline-date">Expected by 25 Apr 2025</div>
                                    <div class="timeline-title">Order Shipped</div>
                                    <div class="timeline-text">Your order will be shipped soon.</div>
                                </div>
                                <div class="timeline-item pending">
                                    <div class="timeline-date">Expected by 29 Apr 2025</div>
                                    <div class="timeline-title">Order Delivered</div>
                                    <div class="timeline-text">Your order will be delivered to your shipping address.</div>
                                </div>
                            </div>
                             -->
                            <!-- Order Actions -->
                            <!-- <div class="order-actions">
                              
                                <% if (productElem.status == "Pending" || productElem.status == "Shipped" || productElem.status == "Placed" || productElem.status == "Out of Delivery") { %>
                                    <button class="action-btn cancel" data-bs-toggle="modal" data-bs-target="#cancelOrderModal">
                                        <i class="fas fa-times-circle"></i>
                                        <span>Cancel</span>
                                    </button>
                                <% } %>
                                <div class="action-btn replace">
                                    
                                </div>
                                <div class="action-btn replace">
                                    <i class="fas fa-exchange-alt"></i>
                                    <span>Replace</span>
                                </div>
                                <div class="action-btn track">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>Track</span>
                                </div>
                            </div> -->
                           
  
                            <!-- Order Summary -->
                            <div class="order-summary">
                                <h5 class="mb-3">Order Summary</h5>
                                <div class="summary-row">
                                    <div class="summary-label">Item(s) Subtotal:</div>
                                    <div class="summary-value">₹ <%= orders.totalAmount+orders.totalDiscount %></div>
                                </div>
                                <div class="summary-row">
                                    <div class="summary-label">Shipping:</div>
                                    <div class="summary-value">₹0</div>
                                </div>
                                <div class="summary-row">
                                    <div class="summary-label">Tax:</div>
                                    <div class="summary-value">₹0</div>
                                </div>
                                <% if (orders.coupon>10) { %>
                                    <div class="summary-row">
                                    <div class="summary-label">Coupon:</div>
                                    <div class="summary-value">₹<%= couponDiscount%></div>
                                </div>
                                <% } %>
                                <div class="summary-row">
                                    <div class="summary-label">Discount:</div>
                                    <div class="summary-value text-success"><%= orders.totalDiscount %></div>
                                </div>
                                <div class="summary-row total-row">
                                    <div>Total:</div>
                                    <div>₹ <%= orders.totalAmount %></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recommended Products -->
                     <!-- <div class="recommended-products">
                        <h5 class="recommended-title">Items that go well with this item</h5>
                        <div class="row">
                            
                            <div class="col-6 col-md-3 mb-4">
                                <div class="product-card">
                                    <div class="position-relative">
                                        <img src="images/product-2.jpg" alt="Product" class="product-card-img">
                                        <button class="wishlist-btn">
                                            <i class="far fa-heart"></i>
                                        </button>
                                    </div>
                                    <div class="product-card-body">
                                        <div class="product-card-brand">The Tie Hub</div>
                                        <div class="product-card-title">Men Pack Of 3 Striped Ankle-Length Socks</div>
                                        <div class="product-card-price">
                                            ₹499 <span class="product-card-original">₹999</span> <span class="product-card-discount">(50% OFF)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                           
                            <div class="col-6 col-md-3 mb-4">
                                <div class="product-card">
                                    <div class="position-relative">
                                        <img src="images/product-3.jpg" alt="Product" class="product-card-img">
                                        <button class="wishlist-btn">
                                            <i class="far fa-heart"></i>
                                        </button>
                                    </div>
                                    <div class="product-card-body">
                                        <div class="product-card-brand">The Tie Hub</div>
                                        <div class="product-card-title">Men Patterned Cotton Crew Socks</div>
                                        <div class="product-card-price">
                                            ₹399 <span class="product-card-original">₹799</span> <span class="product-card-discount">(50% OFF)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-6 col-md-3 mb-4">
                                <div class="product-card">
                                    <div class="position-relative">
                                        <img src="images/product-4.jpg" alt="Product" class="product-card-img">
                                        <button class="wishlist-btn">
                                            <i class="far fa-heart"></i>
                                        </button>
                                    </div>
                                    <div class="product-card-body">
                                        <div class="product-card-brand">HUGO</div>
                                        <div class="product-card-title">Men Rectangle Sunglasses</div>
                                        <div class="product-card-price">
                                            ₹3,999 <span class="product-card-original">₹5,999</span> <span class="product-card-discount">(33% OFF)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                          
                            <div class="col-6 col-md-3 mb-4">
                                <div class="product-card">
                                    <div class="position-relative">
                                        <img src="images/product-5.jpg" alt="Product" class="product-card-img">
                                        <button class="wishlist-btn">
                                            <i class="far fa-heart"></i>
                                        </button>
                                    </div>
                                    <div class="product-card-body">
                                        <div class="product-card-brand">Polo Ralph Lauren</div>
                                        <div class="product-card-title">Men Slim Fit Blue Jeans</div>
                                        <div class="product-card-price">
                                            ₹4,999 <span class="product-card-original">₹7,999</span> <span class="product-card-discount">(38% OFF)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
    </section>
    <!-- Cancel Order Modal -->
    <div class="modal fade" id="cancelOrderModal1" tabindex="-1" aria-labelledby="cancelOrderModalLabel1" aria-hidden="true">
        <div class="modal-dialog">
        
            <input type="hidden" name="cancelModal1" id="cancelModal1" value="">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cancelOrderModalLabel1">Cancel Order</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
                <input type="hidden" name="orderId" id="cancelOrderId" />
                <p>Are you sure you want to cancel this order?</p>
                <input id="orderid" type="hidden" value="<%=orderId %>">
                <div class="mb-3">
                <label for="cancelReason1" class="form-label">Reason for Cancellation (optional):</label>
                <textarea class="form-control" id="cancelReason1"  name="reason" rows="3" placeholder="Write your reason..."></textarea>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button"  class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

                <button onclick="setCancelOrder('<%= orders._id %>')" class="btn btn-danger">Confirm Cancel</button>    
            </div>
            </div>
        
        </div>
    </div>
     <!-- Cancel Order Modal -->
     <div class="modal fade" id="cancelOrderModal" tabindex="-1" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        
            <input type="hidden" name="cancelModal" id="cancelModal" value="">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cancelOrderModalLabel">Cancel Order</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body">
                <input type="hidden" name="orderId" id="cancelOrderId" />
                <p>Are you sure you want to cancel this order?</p>
                <input id="orderid" type="hidden" value="<%=orderId %>">
                <div class="mb-3">
                <label for="cancelReason" class="form-label">Reason for Cancellation (optional):</label>
                <textarea class="form-control" id="cancelReason"  name="reason" rows="3" placeholder="Write your reason..."></textarea>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button"  class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

                <button onclick="CancelOrderId('<%= orders._id %>')" class="btn btn-danger">Confirm Cancel</button>    
            </div>
            </div>
        
        </div>
    </div>

    <!-- Return Reason Modal -->
        <div class="modal fade" id="returnReasonModal" tabindex="-1" aria-labelledby="returnReasonModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content rounded-3">
            <div class="modal-header">
                <h5 class="modal-title" id="returnReasonModalLabel">Return Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <form id="returnReasonForm">
                <div class="modal-body">
                <div class="mb-3">
                    <label for="returnReason" class="form-label">Reason for return</label>
                    <textarea class="form-control" id="returnReason" name="reason" rows="4" placeholder="Enter your reason here..."></textarea>
                </div>
                </div>

                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Confirm</button>
                </div>
            </form>

            </div>
        </div>
        </div>

  

    <!-- Footer -->
    <%- include('../partials/footer') %>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="js/script.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
       
        function openModal(prodId,orderId){
            event.preventDefault()
            document.getElementById('cancelModal1').value = prodId

            let myModal = new bootstrap.Modal(document.getElementById('cancelOrderModal1'));
            myModal.show();
        }
            
            function setCancelOrder(orderId) {
            let reason = document.getElementById('cancelReason1').value
            
            let productId = document.getElementById('cancelModal1').value
                
            console.log(orderId,   reason,   productId)

            fetch('/myorder/cancel',{
                method:'post',
                headers:{
                    "Content-type":"application/json"
                },
                body:JSON.stringify({reason,productId,orderId})
                
            })
            .then(response=>response.json())
            .then(data=>{
                if(data.success){
                    showToast(data.message||'','success')
                    setTimeout(()=>{window.location.reload()},2000)
                }else{
                    showToast(data.message || '','error')
                }
            })
        }

        function CancelOrderId(orderId){
            let cancelReason = document.getElementById('cancelReason').value
            console.log(orderId,"this is the oder id")
            console.log(cancelReason,"this is the reason")
            fetch('/myorder/bulkCancel',{
                method:'post',
                headers:{
                    "Content-type":"application/json"
                },
                body:JSON.stringify({orderId,cancelReason})
            }).then(response=>response.json())
            .then(data=>{
                if(data.success){
                    showToast(data.message||'','success')
                    setTimeout(()=>{window.location.reload()},2000)
                }else{
                    showToast("Some thing went wrong",'error')
                }
            })
        }
        function returnOrderOpenModal(prodId,orderId,currentStatus){
            console.log(prodId,   orderId,   currentStatus)
            document.getElementById('returnReasonForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const reason = document.getElementById('returnReason').value.trim();

            if (!reason) {
            showToast("Please provide a reason for return.","warning");
            return;
            }
            if (reason.length<3) {
            showToast("Please provide a valid reason for return.","warning");
            return;
            }

            fetch('/order/return',{
                        method:'post',
                        headers:{
                            "Content-type":"application/json"
                        },
                        body:JSON.stringify({prodId,orderId,currentStatus})
                    }).then((response)=>response.json())
                        .then(data=>{
                            if(data.success){
                                showToast(data.message||'','success')
                                setTimeout(()=>{window.location.reload()},2000)
                            }else{  
                                showToast(data.message||'','error')
                            }
                        })

            // Optionally close modal
            const returnModal = bootstrap.Modal.getInstance(document.getElementById('returnReasonModal'));
            returnModal.hide();

            
        });
        }
         
        function returnOrder(prodId,orderId,currentStatus){
            Swal.fire({
                    title: 'Are you sure?',
                    text: 'Are you sure you want to Return the product!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, change it!',
                    cancelButtonText: 'No, cancel!',
                }).then((result) => {
                    if(result.isConfirmed){
                        
                    }
                    
                })
        }
            
          async function retryPayment(retryOrderId) {
            try {
                const defaultAddress = document.getElementById('default-address').value;
                const totalAmount = document.getElementById('total-price').value;

                if (!defaultAddress || !totalAmount) {
                    showToast('Missing address or amount', 'error');
                    return;
                }

                const response = await fetch('/create-razorpay-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        defaultAddress,
                        totalAmount,
                        retryOrderId
                    }),
                });

                const data = await response.json();

                if (data.error) {
                    showToast(data.error, 'error');
                    return;
                }

                const options = {
                    key: data.key_id,
                    amount: data.amount,
                    currency: data.currency,
                    order_id: data.order_id,
                    name: 'Blend',
                    description: `Retry Payment for Order ${retryOrderId}`,
                    handler: async function (response) {
                        try {
                            const paymentResponse = await fetch('/payment-success', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    razorpay_order_id: response.razorpay_order_id,
                                    razorpay_payment_id: response.razorpay_payment_id,
                                    razorpay_signature: response.razorpay_signature,
                                    retryOrderId
                                }),
                            });

                            const paymentData = await paymentResponse.json();

                            if (paymentData.error) {
                                showToast(paymentData.error, 'error');
                            } else {
                                showToast('Payment successful', 'success');
                                setTimeout(() => { window.location.reload(); }, 2000);
                            }
                        } catch (error) {
                            console.error('Payment Success Error:', error);
                            showToast('Payment Success', 'success');
                            setTimeout(() => {
                                window.location.location = '/checkoutsuccess'
                            }, 2000);
                        }
                    },
                    prefill: {
                        name: data.user.name,
                        email: data.user.email,
                        contact: data.user.contact
                    },
                    theme: {
                        color: '#343a40'
                    }
                };

                const rzp = new Razorpay(options);
                rzp.on('payment.failed', function (response) {
                    showToast(response.error.description || 'Payment failed', 'error');
                    window.location.href = '/checkoutfailure';
                });
                rzp.open();
            } catch (error) {
                console.error('Retry Payment Error:', error);
                showToast('Failed to initiate payment', 'error');
            }
        }

    </script>
</body>
</html>